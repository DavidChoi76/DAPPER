<!-- Search file for "CHANGE" for my own changes -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>dapper.tools.utils API documentation</title>
<meta name="description" content="Utilities (misc, non-math)." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<link rel="icon" href="https://raw.githubusercontent.com/nansencenter/DAPPER/master/docs/imgs/logo.png">
<!-- Dont work coz pdoc already defines these:
<title>DAPPER doc</title>
<meta name="description" content="Data Assimilation with Python: a Package for Experimental Research" />
-->
<a href="https://github.com/nansencenter/DAPPER" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>dapper.tools.utils</code></h1>
</header>
<section id="section-intro">
<p>Utilities (misc, non-math).</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L0-L377" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34;Utilities (misc, non-math).&#34;&#34;&#34;

import contextlib
import functools
import inspect
import os
import re
import sys
import time
import traceback as tb
from pathlib import Path

import tabulate
import tqdm
from tabulate import tabulate as tab  # noqa

from dapper.dict_tools import NicePrint
from dapper.dpr_config import rc

tabulate.MIN_PADDING = 0


#########################################
# Progressbar
#########################################

def pdesc(desc):
    &#34;Get progbar description by introspection.&#34;

    if desc is not None:
        return desc

    stack = inspect.stack()
    # Gives FULL REPR:
    # stack[4].frame.f_locals[&#39;name_hook&#39;]

    # Go look above in the stack for a name_hook.
    for level in range(2, 6):
        try:
            locals = stack[level].frame.f_locals
        except IndexError:
            pass
        else:
            if &#39;pb_name_hook&#39; in locals:
                name = locals[&#39;pb_name_hook&#39;]
                break
    else:
        # Otherwise: just get name of what&#39;s
        # calling progbar (i.e. stack[2])
        name = stack[2].function

    return name


def progbar(iterable, desc=None, leave=1, **kwargs):
    &#34;Prints a nice progress bar in the terminal&#34;
    if disable_progbar:
        return iterable
    else:
        desc = pdesc(desc)
        # if is_notebook:
        # This fails in QtConsole (which also yields is_notebook==True)
        # return tqdm.tqdm_notebook(iterable,desc=desc,leave=leave)
        # else:
        return tqdm.tqdm(iterable, desc=desc, leave=leave,
                         smoothing=0.3, dynamic_ncols=True, **kwargs)
        # Printing during the progbar loop (may occur with error printing)
        # can cause tqdm to freeze the entire execution.
        # Seemingly, this is caused by their multiprocessing-safe stuff.
        # Disable this, as per github.com/tqdm/tqdm/issues/461#issuecomment-334343230
        # pb = tqdm.tqdm(...)
        # try: pb.get_lock().locks = []
        # except AttributeError: pass
        # return pb


#########################################
# Make read1()
#########################################
# Non-blocking, non-echo read1 from stdin.

# Set to True when stdin or term settings isn&#39;t supported, for example when:
#  - running via py.test
#  - multiprocessing
# Btw, multiprocessing also doesn&#39;t like tqdm itself.
disable_user_interaction = False
disable_progbar = False

try:
    # Linux. See Misc/read1_trials.py
    import termios

    def set_term_settings(TS):
        termios.tcsetattr(sys.stdin, termios.TCSADRAIN, TS)

    def new_term_settings():
        &#34;&#34;&#34;Make stdin.read non-echo and non-block&#34;&#34;&#34;
        # NB: This makes ipython quit (by pressing C^D twice) hang!
        #     So it should be undone before returning to prompt.
        #     Thus, setting/restoring at import/atexit is not viable.

        TS_old = termios.tcgetattr(sys.stdin)
        TS_new = termios.tcgetattr(sys.stdin)

        # Make tty non-echo.
        TS_new[3] = TS_new[3] &amp; ~(termios.ECHO | termios.ICANON)

        # Make tty non-blocking.
        TS_new[6][termios.VMIN] = 0
        TS_new[6][termios.VTIME] = 0

        set_term_settings(TS_new)
        return TS_old

    try:
        # Test set/restore settings
        TS_old = new_term_settings()
        set_term_settings(TS_old)

        orig_progbar = progbar

        # Wrap the progressbar generator so as to temporarily set term settings.
        # Alternative solution: set/restore term settings in assimilate()
        # of the da_method decorator. But that gets bloated, and anyways the logic
        # of user-control of liveplots kindof belongs together with a progressbar.
        def progbar(iterable, desc=None, leave=1, **kwargs):
            if not disable_user_interaction:
                TS_old = new_term_settings()
            try:
                for i in orig_progbar(iterable, pdesc(desc), leave, **kwargs):
                    yield i
            except GeneratorExit:
                # Allows code below to run even if caller raised exception
                # NB: Fails if caller is in a list-comprehesion! Why?
                pass
            # Restore both for normal termination or exception (propagates).
            if not disable_user_interaction:
                set_term_settings(TS_old)

        def _read1():
            return os.read(sys.stdin.fileno(), 1)

    except:  # noqa
        # Fails in non-terminal environments
        disable_user_interaction = True

except ImportError:
    # Windows
    try:
        import msvcrt  # noqa

        def _read1():
            if msvcrt.kbhit():
                return msvcrt.getch()
            else:
                return None

    except ImportError:
        disable_user_interaction = True


def read1():
    &#34;Get 1 character. Non-blocking, non-echoing.&#34;
    if disable_user_interaction:
        return None
    return _read1()


#########################################
# Console input / output
#########################################

def print_cropped_traceback(ERR):

    def crop_traceback(ERR, lvl):
        msg = &#34;Traceback (most recent call last):\n&#34;
        try:
            # If in IPython, use its coloring functionality
            __IPYTHON__  # noqa
            from IPython.core.debugger import Pdb
            pdb_instance = Pdb()
            pdb_instance.curframe = inspect.currentframe()

            for i, frame in enumerate(tb.walk_tb(ERR.__traceback__)):
                if i &lt; lvl:
                    continue  # skip frames
                if i == lvl:
                    msg += &#34;   ⋮ [cropped] \n&#34;
                msg += pdb_instance.format_stack_entry(frame, context=3)

        except (NameError, ImportError):
            msg += &#34;&#34;.join(tb.format_tb(ERR.__traceback__))

        return msg

    msg = crop_traceback(ERR, 1) + &#34;\nError message: &#34; + str(ERR)
    msg += &#34;\n\nResuming execution. &#34; \
        &#34;Use `fail_gently=False` to raise exception &amp; halt execution.\n&#34;
    print(msg, file=sys.stderr)


def repr_type_and_name(thing):
    &#34;&#34;&#34;Print thing&#39;s type [and name]&#34;&#34;&#34;
    s = &#34;&lt;&#34; + type(thing).__name__ + &#39;&gt;&#39;
    if hasattr(thing, &#39;name&#39;):
        s += &#39;: &#39; + thing.name
    return s


# https://stackoverflow.com/q/22797580
# https://stackoverflow.com/q/10875442
class NamedFunc():
    &#34;Provides custom repr for functions.&#34;

    def __init__(self, func, name):
        self._function = func
        self._old_name = func.__name__
        self._new_name = name
        functools.update_wrapper(self, func)

    def __call__(self, *args, **kwargs):
        return self._function(*args, **kwargs)

    def __str__(self):
        return self._new_name + &#34;()&#34;

    def __repr__(self):
        return str(self) + f&#34; &lt;NamedFunc of {self._old_name}&gt;&#34;


def name_func(name):
    &#34;&#34;&#34;Decorator for creating NamedFunc.&#34;&#34;&#34;
    def namer(func):
        return NamedFunc(func, name)
    return namer


#########################################
# Misc
#########################################

def rel2mods(path):
    path = Path(path).relative_to(rc.dirs.dapper/&#39;mods&#39;).with_suffix(&#34;&#34;)
    return str(path)

# # Temporarily set attribute values
# @contextlib.contextmanager
# def set_tmp(obj,attr,val):
#     tmp = getattr(obj,attr)
#     setattr(obj,attr,val)
#     yield
#     setattr(obj,attr,tmp)


@contextlib.contextmanager
def set_tmp(obj, attr, val):
    &#34;&#34;&#34;Temporarily set an attribute.

    Example:
    &gt;&gt;&gt; class A:
    &gt;&gt;&gt;     pass
    &gt;&gt;&gt; a = A()
    &gt;&gt;&gt; a.x = 1  # Try deleting this line
    &gt;&gt;&gt; with set_tmp(a,&#34;x&#34;,&#34;TEMPVAL&#34;):
    &gt;&gt;&gt;     print(a.x)
    &gt;&gt;&gt; print(a.x)

    Based on
    http://code.activestate.com/recipes/577089/
    &#34;&#34;&#34;

    was_there = False
    tmp = None
    if hasattr(obj, attr):
        try:
            if attr in obj.__dict__:
                was_there = True
        except AttributeError:
            if attr in obj.__slots__:
                was_there = True
        if was_there:
            tmp = getattr(obj, attr)
    setattr(obj, attr, val)

    try:
        yield  # was_there, tmp
    except BaseException:
        raise
    finally:
        if not was_there:
            delattr(obj, attr)
        else:
            setattr(obj, attr, tmp)


# Better than tic-toc !
class Timer():
    &#34;&#34;&#34;Timer context manager.

    Example::

    &gt;&gt;&gt; with Timer(&#39;&lt;description&gt;&#39;):
    &gt;&gt;&gt;     time.sleep(1.23)
    [&lt;description&gt;] Elapsed: 1.23
    &#34;&#34;&#34;

    def __init__(self, name=None):
        self.name = name

    def __enter__(self):
        self.tstart = time.time()

    def __exit__(self, type, value, traceback):
        # pass # Turn off timer messages
        if self.name:
            print(&#39;[%s]&#39; % self.name, end=&#39; &#39;)
        print(&#39;Elapsed: %s&#39; % (time.time() - self.tstart))


def find_1st_ind(xx):
    try:
        return next(k for k, x in enumerate(xx) if x)
    except StopIteration:
        return None


# https://stackoverflow.com/a/2669120
def sorted_human(lst):
    &#34;&#34;&#34;Sort the given iterable in the way that humans expect.&#34;&#34;&#34;
    def convert(text): return int(text) if text.isdigit() else text
    def alphanum_key(key): return [convert(c) for c in re.split(&#39;([0-9]+)&#39;, key)]
    return sorted(lst, key = alphanum_key)


def collapse_str(string, length=6):
    &#34;&#34;&#34;Abbreviate string to ``length``&#34;&#34;&#34;
    if len(string) &lt;= length:
        return string
    else:
        return string[:length-2]+&#39;~&#39;+string[-1]


def all_but_1_is_None(*args):
    &#34;Check if only 1 of the items in list are Truthy&#34;
    return sum(x is not None for x in args) == 1


def do_once(fun):
    def new(*args, **kwargs):
        if new.already_done:
            return None  # do nothing
        else:
            new.already_done = True
            return fun(*args, **kwargs)
    new.already_done = False
    return new


def monitor_setitem(cls):
    &#34;&#34;&#34;Modify cls to track of whether its ``__setitem__`` has been called.

    See sub.py for a sublcass solution (drawback: creates a new class).&#34;&#34;&#34;

    orig_setitem = cls.__setitem__

    def setitem(self, key, val):
        orig_setitem(self, key, val)
        self.were_changed = True
    cls.__setitem__ = setitem

    # Using class var for were_changed =&gt; don&#39;t need explicit init
    cls.were_changed = False

    if issubclass(cls, NicePrint):
        cls.printopts[&#39;excluded&#39;] = \
                cls.printopts.get(&#39;excluded&#39;, []) + [&#39;were_changed&#39;]

    return cls</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="dapper.tools.utils.pdesc"><code class="name flex">
<span>def <span class="ident">pdesc</span></span>(<span>desc)</span>
</code></dt>
<dd>
<div class="desc"><p>Get progbar description by introspection.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L27-L52" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def pdesc(desc):
    &#34;Get progbar description by introspection.&#34;

    if desc is not None:
        return desc

    stack = inspect.stack()
    # Gives FULL REPR:
    # stack[4].frame.f_locals[&#39;name_hook&#39;]

    # Go look above in the stack for a name_hook.
    for level in range(2, 6):
        try:
            locals = stack[level].frame.f_locals
        except IndexError:
            pass
        else:
            if &#39;pb_name_hook&#39; in locals:
                name = locals[&#39;pb_name_hook&#39;]
                break
    else:
        # Otherwise: just get name of what&#39;s
        # calling progbar (i.e. stack[2])
        name = stack[2].function

    return name</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.progbar"><code class="name flex">
<span>def <span class="ident">progbar</span></span>(<span>iterable, desc=None, leave=1, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L126-L138" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def progbar(iterable, desc=None, leave=1, **kwargs):
    if not disable_user_interaction:
        TS_old = new_term_settings()
    try:
        for i in orig_progbar(iterable, pdesc(desc), leave, **kwargs):
            yield i
    except GeneratorExit:
        # Allows code below to run even if caller raised exception
        # NB: Fails if caller is in a list-comprehesion! Why?
        pass
    # Restore both for normal termination or exception (propagates).
    if not disable_user_interaction:
        set_term_settings(TS_old)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.set_term_settings"><code class="name flex">
<span>def <span class="ident">set_term_settings</span></span>(<span>TS)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L93-L94" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def set_term_settings(TS):
    termios.tcsetattr(sys.stdin, termios.TCSADRAIN, TS)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.new_term_settings"><code class="name flex">
<span>def <span class="ident">new_term_settings</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Make stdin.read non-echo and non-block</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L96-L113" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def new_term_settings():
    &#34;&#34;&#34;Make stdin.read non-echo and non-block&#34;&#34;&#34;
    # NB: This makes ipython quit (by pressing C^D twice) hang!
    #     So it should be undone before returning to prompt.
    #     Thus, setting/restoring at import/atexit is not viable.

    TS_old = termios.tcgetattr(sys.stdin)
    TS_new = termios.tcgetattr(sys.stdin)

    # Make tty non-echo.
    TS_new[3] = TS_new[3] &amp; ~(termios.ECHO | termios.ICANON)

    # Make tty non-blocking.
    TS_new[6][termios.VMIN] = 0
    TS_new[6][termios.VTIME] = 0

    set_term_settings(TS_new)
    return TS_old</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.orig_progbar"><code class="name flex">
<span>def <span class="ident">orig_progbar</span></span>(<span>iterable, desc=None, leave=1, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Prints a nice progress bar in the terminal</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L55-L66" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def progbar(iterable, desc=None, leave=1, **kwargs):
    &#34;Prints a nice progress bar in the terminal&#34;
    if disable_progbar:
        return iterable
    else:
        desc = pdesc(desc)
        # if is_notebook:
        # This fails in QtConsole (which also yields is_notebook==True)
        # return tqdm.tqdm_notebook(iterable,desc=desc,leave=leave)
        # else:
        return tqdm.tqdm(iterable, desc=desc, leave=leave,
                         smoothing=0.3, dynamic_ncols=True, **kwargs)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.read1"><code class="name flex">
<span>def <span class="ident">read1</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Get 1 character. Non-blocking, non-echoing.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L162-L166" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def read1():
    &#34;Get 1 character. Non-blocking, non-echoing.&#34;
    if disable_user_interaction:
        return None
    return _read1()</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.print_cropped_traceback"><code class="name flex">
<span>def <span class="ident">print_cropped_traceback</span></span>(<span>ERR)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L173-L199" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def print_cropped_traceback(ERR):

    def crop_traceback(ERR, lvl):
        msg = &#34;Traceback (most recent call last):\n&#34;
        try:
            # If in IPython, use its coloring functionality
            __IPYTHON__  # noqa
            from IPython.core.debugger import Pdb
            pdb_instance = Pdb()
            pdb_instance.curframe = inspect.currentframe()

            for i, frame in enumerate(tb.walk_tb(ERR.__traceback__)):
                if i &lt; lvl:
                    continue  # skip frames
                if i == lvl:
                    msg += &#34;   ⋮ [cropped] \n&#34;
                msg += pdb_instance.format_stack_entry(frame, context=3)

        except (NameError, ImportError):
            msg += &#34;&#34;.join(tb.format_tb(ERR.__traceback__))

        return msg

    msg = crop_traceback(ERR, 1) + &#34;\nError message: &#34; + str(ERR)
    msg += &#34;\n\nResuming execution. &#34; \
        &#34;Use `fail_gently=False` to raise exception &amp; halt execution.\n&#34;
    print(msg, file=sys.stderr)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.repr_type_and_name"><code class="name flex">
<span>def <span class="ident">repr_type_and_name</span></span>(<span>thing)</span>
</code></dt>
<dd>
<div class="desc"><p>Print thing's type [and name]</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L202-L207" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def repr_type_and_name(thing):
    &#34;&#34;&#34;Print thing&#39;s type [and name]&#34;&#34;&#34;
    s = &#34;&lt;&#34; + type(thing).__name__ + &#39;&gt;&#39;
    if hasattr(thing, &#39;name&#39;):
        s += &#39;: &#39; + thing.name
    return s</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.name_func"><code class="name flex">
<span>def <span class="ident">name_func</span></span>(<span>name)</span>
</code></dt>
<dd>
<div class="desc"><p>Decorator for creating NamedFunc.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L231-L235" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def name_func(name):
    &#34;&#34;&#34;Decorator for creating NamedFunc.&#34;&#34;&#34;
    def namer(func):
        return NamedFunc(func, name)
    return namer</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.rel2mods"><code class="name flex">
<span>def <span class="ident">rel2mods</span></span>(<span>path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L242-L244" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def rel2mods(path):
    path = Path(path).relative_to(rc.dirs.dapper/&#39;mods&#39;).with_suffix(&#34;&#34;)
    return str(path)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.set_tmp"><code class="name flex">
<span>def <span class="ident">set_tmp</span></span>(<span>obj, attr, val)</span>
</code></dt>
<dd>
<div class="desc"><p>Temporarily set an attribute.</p>
<p>Example:</p>
<pre><code class="language-python-repl">&gt;&gt;&gt; class A:
&gt;&gt;&gt;     pass
&gt;&gt;&gt; a = A()
&gt;&gt;&gt; a.x = 1  # Try deleting this line
&gt;&gt;&gt; with set_tmp(a,&quot;x&quot;,&quot;TEMPVAL&quot;):
&gt;&gt;&gt;     print(a.x)
&gt;&gt;&gt; print(a.x)
</code></pre>
<p>Based on
<a href="http://code.activestate.com/recipes/577089/">http://code.activestate.com/recipes/577089/</a></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L255-L293" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@contextlib.contextmanager
def set_tmp(obj, attr, val):
    &#34;&#34;&#34;Temporarily set an attribute.

    Example:
    &gt;&gt;&gt; class A:
    &gt;&gt;&gt;     pass
    &gt;&gt;&gt; a = A()
    &gt;&gt;&gt; a.x = 1  # Try deleting this line
    &gt;&gt;&gt; with set_tmp(a,&#34;x&#34;,&#34;TEMPVAL&#34;):
    &gt;&gt;&gt;     print(a.x)
    &gt;&gt;&gt; print(a.x)

    Based on
    http://code.activestate.com/recipes/577089/
    &#34;&#34;&#34;

    was_there = False
    tmp = None
    if hasattr(obj, attr):
        try:
            if attr in obj.__dict__:
                was_there = True
        except AttributeError:
            if attr in obj.__slots__:
                was_there = True
        if was_there:
            tmp = getattr(obj, attr)
    setattr(obj, attr, val)

    try:
        yield  # was_there, tmp
    except BaseException:
        raise
    finally:
        if not was_there:
            delattr(obj, attr)
        else:
            setattr(obj, attr, tmp)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.find_1st_ind"><code class="name flex">
<span>def <span class="ident">find_1st_ind</span></span>(<span>xx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L320-L324" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def find_1st_ind(xx):
    try:
        return next(k for k, x in enumerate(xx) if x)
    except StopIteration:
        return None</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.sorted_human"><code class="name flex">
<span>def <span class="ident">sorted_human</span></span>(<span>lst)</span>
</code></dt>
<dd>
<div class="desc"><p>Sort the given iterable in the way that humans expect.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L328-L332" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def sorted_human(lst):
    &#34;&#34;&#34;Sort the given iterable in the way that humans expect.&#34;&#34;&#34;
    def convert(text): return int(text) if text.isdigit() else text
    def alphanum_key(key): return [convert(c) for c in re.split(&#39;([0-9]+)&#39;, key)]
    return sorted(lst, key = alphanum_key)</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.collapse_str"><code class="name flex">
<span>def <span class="ident">collapse_str</span></span>(<span>string, length=6)</span>
</code></dt>
<dd>
<div class="desc"><p>Abbreviate string to <code>length</code></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L335-L340" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def collapse_str(string, length=6):
    &#34;&#34;&#34;Abbreviate string to ``length``&#34;&#34;&#34;
    if len(string) &lt;= length:
        return string
    else:
        return string[:length-2]+&#39;~&#39;+string[-1]</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.all_but_1_is_None"><code class="name flex">
<span>def <span class="ident">all_but_1_is_None</span></span>(<span>*args)</span>
</code></dt>
<dd>
<div class="desc"><p>Check if only 1 of the items in list are Truthy</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L343-L345" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def all_but_1_is_None(*args):
    &#34;Check if only 1 of the items in list are Truthy&#34;
    return sum(x is not None for x in args) == 1</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.do_once"><code class="name flex">
<span>def <span class="ident">do_once</span></span>(<span>fun)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L348-L356" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def do_once(fun):
    def new(*args, **kwargs):
        if new.already_done:
            return None  # do nothing
        else:
            new.already_done = True
            return fun(*args, **kwargs)
    new.already_done = False
    return new</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.monitor_setitem"><code class="name flex">
<span>def <span class="ident">monitor_setitem</span></span>(<span>cls)</span>
</code></dt>
<dd>
<div class="desc"><p>Modify cls to track of whether its <code>__setitem__</code> has been called.</p>
<p>See sub.py for a sublcass solution (drawback: creates a new class).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L359-L378" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def monitor_setitem(cls):
    &#34;&#34;&#34;Modify cls to track of whether its ``__setitem__`` has been called.

    See sub.py for a sublcass solution (drawback: creates a new class).&#34;&#34;&#34;

    orig_setitem = cls.__setitem__

    def setitem(self, key, val):
        orig_setitem(self, key, val)
        self.were_changed = True
    cls.__setitem__ = setitem

    # Using class var for were_changed =&gt; don&#39;t need explicit init
    cls.were_changed = False

    if issubclass(cls, NicePrint):
        cls.printopts[&#39;excluded&#39;] = \
                cls.printopts.get(&#39;excluded&#39;, []) + [&#39;were_changed&#39;]

    return cls</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="dapper.tools.utils.NamedFunc"><code class="flex name class">
<span>class <span class="ident">NamedFunc</span></span>
<span>(</span><span>func, name)</span>
</code></dt>
<dd>
<div class="desc"><p>Provides custom repr for functions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L212-L228" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class NamedFunc():
    &#34;Provides custom repr for functions.&#34;

    def __init__(self, func, name):
        self._function = func
        self._old_name = func.__name__
        self._new_name = name
        functools.update_wrapper(self, func)

    def __call__(self, *args, **kwargs):
        return self._function(*args, **kwargs)

    def __str__(self):
        return self._new_name + &#34;()&#34;

    def __repr__(self):
        return str(self) + f&#34; &lt;NamedFunc of {self._old_name}&gt;&#34;</code></pre>
</details>
</dd>
<dt id="dapper.tools.utils.Timer"><code class="flex name class">
<span>class <span class="ident">Timer</span></span>
<span>(</span><span>name=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Timer context manager.</p>
<p>Example::</p>
<pre><code class="language-python-repl">&gt;&gt;&gt; with Timer('&lt;description&gt;'):
&gt;&gt;&gt;     time.sleep(1.23)
[&lt;description&gt;] Elapsed: 1.23
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/c3114add20530fd2bfe6521b9f5b46d825149385/dapper/tools/utils.py#L297-L317" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Timer():
    &#34;&#34;&#34;Timer context manager.

    Example::

    &gt;&gt;&gt; with Timer(&#39;&lt;description&gt;&#39;):
    &gt;&gt;&gt;     time.sleep(1.23)
    [&lt;description&gt;] Elapsed: 1.23
    &#34;&#34;&#34;

    def __init__(self, name=None):
        self.name = name

    def __enter__(self):
        self.tstart = time.time()

    def __exit__(self, type, value, traceback):
        # pass # Turn off timer messages
        if self.name:
            print(&#39;[%s]&#39; % self.name, end=&#39; &#39;)
        print(&#39;Elapsed: %s&#39; % (time.time() - self.tstart))</code></pre>
</details>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="DAPPER" href="https://nansencenter.github.io/DAPPER">
<img src="https://raw.githubusercontent.com/nansencenter/DAPPER/master/docs/imgs/logo_wtxt.png" alt="">
<!-- can add style="width:200px;" to img -->
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="dapper.tools" href="index.html">dapper.tools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="dapper.tools.utils.pdesc" href="#dapper.tools.utils.pdesc">pdesc</a></code></li>
<li><code><a title="dapper.tools.utils.progbar" href="#dapper.tools.utils.progbar">progbar</a></code></li>
<li><code><a title="dapper.tools.utils.set_term_settings" href="#dapper.tools.utils.set_term_settings">set_term_settings</a></code></li>
<li><code><a title="dapper.tools.utils.new_term_settings" href="#dapper.tools.utils.new_term_settings">new_term_settings</a></code></li>
<li><code><a title="dapper.tools.utils.orig_progbar" href="#dapper.tools.utils.orig_progbar">orig_progbar</a></code></li>
<li><code><a title="dapper.tools.utils.read1" href="#dapper.tools.utils.read1">read1</a></code></li>
<li><code><a title="dapper.tools.utils.print_cropped_traceback" href="#dapper.tools.utils.print_cropped_traceback">print_cropped_traceback</a></code></li>
<li><code><a title="dapper.tools.utils.repr_type_and_name" href="#dapper.tools.utils.repr_type_and_name">repr_type_and_name</a></code></li>
<li><code><a title="dapper.tools.utils.name_func" href="#dapper.tools.utils.name_func">name_func</a></code></li>
<li><code><a title="dapper.tools.utils.rel2mods" href="#dapper.tools.utils.rel2mods">rel2mods</a></code></li>
<li><code><a title="dapper.tools.utils.set_tmp" href="#dapper.tools.utils.set_tmp">set_tmp</a></code></li>
<li><code><a title="dapper.tools.utils.find_1st_ind" href="#dapper.tools.utils.find_1st_ind">find_1st_ind</a></code></li>
<li><code><a title="dapper.tools.utils.sorted_human" href="#dapper.tools.utils.sorted_human">sorted_human</a></code></li>
<li><code><a title="dapper.tools.utils.collapse_str" href="#dapper.tools.utils.collapse_str">collapse_str</a></code></li>
<li><code><a title="dapper.tools.utils.all_but_1_is_None" href="#dapper.tools.utils.all_but_1_is_None">all_but_1_is_None</a></code></li>
<li><code><a title="dapper.tools.utils.do_once" href="#dapper.tools.utils.do_once">do_once</a></code></li>
<li><code><a title="dapper.tools.utils.monitor_setitem" href="#dapper.tools.utils.monitor_setitem">monitor_setitem</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="dapper.tools.utils.NamedFunc" href="#dapper.tools.utils.NamedFunc">NamedFunc</a></code></h4>
</li>
<li>
<h4><code><a title="dapper.tools.utils.Timer" href="#dapper.tools.utils.Timer">Timer</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>